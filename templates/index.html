<html>
    <head>
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <style>

        td, th {
            border: 1px solid #999;
            padding: 0.5rem;
            text-align: left;
        }

        .centro{
            text-align: center; 
        }

        #container {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        </style>
        
    </head>
    <nav class="navbar navbar-light bg-primary justify-content-between">
       
        <form method="POST" action="{{ url_for('register') }}" class="form-inline mx-auto pt-4 pb-3">
        
          <input class="form-control mr-sm-2" name="name" type="text" placeholder="First Name" aria-label="Search">
          <input class="form-control mr-sm-2" name="lastname" type="text" placeholder="Last name" aria-label="Search">
          <input class="form-control mr-sm-2" name="participation"  type="number" placeholder="Participation" aria-label="Search">
          <button class="btn-md btn btn-outline-light my-2 my-sm-0" role="button">Search</button>
            
        </form>
        <a class="btn btn-primary" id="buttonPorcentage" onclick="forPorcent(true)">%</a>
    </nav>

    <body>
        <div class="container pb-4">
            <div class="col-6 mx-auto pt-4"></div>
                <h3 class="mx-auto col-1">Data</h3>
                <p class="mx-auto pl-5 col-5">
                    Lorem ipsum dolor sit amet consectetur adipisicing elit.
                </p>
            
            </div>
        </div>
        
        
        <div class="container col-12">
            <div class="row">
                
                <div class="col col-5 ml-5 pl-5">
                    <table id="tabela" class=" table-default col-12">
                        
                        <thead>
                            <tr class="emptyhead">
                                <th>      </th>
                            </tr>
                                      </thead>
                                      <tbody class="emptybody">
                                         
                                      </tbody>


                    </table>

                </div>


                <div id="builder" class="inline col ml-5 col-1">
                
                        <div id="container" style="width: 600px; height: 400px;"></div>
                
                </div>
            </div>
        </div>
    </body>
    <script src="https://cdn.anychart.com/releases/8.9.0/js/anychart-base.min.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" type="text/javascript"></script>
    <script>
        function buildTable(data){
            $('.emptybody').html("")
            
            $('.emptyhead').html("<th>      </th>")
            var dados = []
            var heads = Object.keys(data[0])
            var headings = ""

            headings += "<th>Name</th><th>Lastname</th><th>participation</th><th>Deletar</th>"
            $('.emptyhead').append(headings);
            for(var i=0; i < data.length; i++){
                var content = "<tr>"
                var row = Object.values(data[i])
                content += "<td>"+i+"</td><td>"+data[i].name+"</td>"+
                "<td>"+data[i].lastname+"</td>"+
                "<td>"+data[i].participation+"</td>" 
                content += "<td><button onclick='deleteRow("+data[i].uniqID+")'>X</button></td>"
                
                content += "</tr>"
                dados[i] = {"x":data[i].name,"value":data[i].participation}
                $('.emptybody').append(content);
                
            }
        }


        function deleteRow(uniqID){
            $.get(url='http://localhost:5000/delete/'+uniqID)
            update()
        }

        function graphPlot(data){
            $("#builder").html(" ")
            
            var dados = []
            $("#builder").html("<div id='container' style='width: 600px; height: 400px;'></div>")
            for(var i=0; i < data.length; i++){
                dados[i] = {"x":data[i].name+" "+data[i].lastname,"value":data[i].participation}
            }


            var chart = anychart.pie(dados);

            chart.innerRadius("75%");

            var labels = chart.labels();
            labels.position("inside");

            labels.fontColor("#000000");
            chart.overlapMode(true);
            chart.insideLabelsOffset("-75%");

            chart.legend(true);


            chart.container("container");


            chart.draw()
            
        

          
        }

        
        function forPorcent(state){
            if (state == true){
            $.get(url='http://localhost:5000/view/percentage', function (data) {
                
                    $('#buttonPorcentage').addClass('active')
                    $("#buttonPorcentage").attr("onclick","forPorcent(false)");
                buildTable(data['data'])
        
                });

            }else if(state == false){
                $.get(url='http://localhost:5000/view', function (data) {
                
                    $('#buttonPorcentage').removeClass('active')
                    $("#buttonPorcentage").attr("onclick","forPorcent(true)");
                buildTable(data['data'])
        
                });
            }

        }
        
        function update(){
            
            $.get(url='http://localhost:5000/view', function (data) {
                graphPlot(data['data'])
                buildTable(data['data'])

            });
        
        }

        update()
        
       
      </script>
</html>